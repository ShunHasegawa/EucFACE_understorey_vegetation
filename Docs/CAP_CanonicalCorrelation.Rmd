---
title: "Canoical correlation for CAP"
author: "Shun Hasegawa"
date: "Wednesday, March 25, 2015"
output: pdf_document
---

Canonical correlation ($\sigma^2$) indicates how much of variability in CAP axes is explained by a treatments of one's interest. In other words, it indicates how clearly data points are split by CAP axes.
`CAPdiscrim` doesn't directly return canonical correlations (there might be though...), so here I discribe how to get canonical correlation manually.

\par

Firstly run CAP analysis.

```{r, message=FALSE, results='markup'}
require(vegan)
require(BiodiversityR)
require(candisc)

data(dune)
data(dune.env)
# CAP analysis
dsm <- vegdist(log(dune + 1), method = "bray")
tes <- CAPdiscrim(dsm ~ Management, data = dune.env, permutations = 1000)
tes
```

What CAP analysis does is to perform principle coordinate analysis (PCoA), and determine
optimal number of axes to be used (m), then to perform canonical discriminant analysis (CDA) using
mth PCoA axes.

\par
From the above CAP analysis, the number of axes to be used is identified to be 2. So using the first 2nd PCoA axes, run CDA.

```{r}

# obtain canonical correlation----

# from above m = 2 so use first two PCO columns
tesPcoMtx <- tes$PCoA[, 1:2]

# run canonical discriminent analysis
ml <- lm(tesPcoMtx ~ dune.env$Management)
cda1 <- candisc(ml, term = "dune.env$Management")
cda1$canrsq
```

Thus, canonical correlations have been given for each of two CAP axes. Please note that these values are same as $R^2$ for ANOVA testing CAP1 (or CAP2) against the treatment of one's interest. 

```{r}
tesdf <- data.frame(tes$x, dune.env)
summary(lm(LD1 ~ Management, data = tesdf))$r.squared
summary(lm(LD2 ~ Management, data = tesdf))$r.squared
  
```
Thus, canonical correlations for CAP are the variation in CAP axis values explained by treatments.
