---
title: "EucFACE understorey vegetation -Summary of stats-"
author: "Shun Hasegawa"
date: "30 March 2016"
output:
  html_document:
    toc: true
---

```{r setup, include=FALSE}
library(pander)
library(ggplot2)
library(grid)
library(plyr)
library(dplyr)
library(MuMIn)
knitr::opts_chunk$set(echo = TRUE)
load("../output/Data/summary_analysis.RData")
load("../output/Data/AllObj.RData")
theme_set(theme_bw() + 
            theme(panel.grid.major = element_blank(), 
                  panel.grid.minor = element_blank()))

```

# Reanalysis

Here, I reanalysed understorey vegetation data, performing ANCOVA using Year0 values as a covariate for univariate analysis and principal response curve (PRC) and MDS for multivariate analysis. I analysed the following variables for univariate analysis:

* Diversity indices
    + Diversity (*H'*)
    + Evenness (*J'*)
    + Species richness (*S*)
* Dominant species
    + _Cynodon dactylon_
    + _Microlaena stipoides_
* Proportion of plant functional groups
    + C~4\_grass

Diversity indices and RDA were analysed for all species together, grass species only, and form species only. 




# Overview of observed species

```{r spp_tbl, echo=FALSE}
pander(spp_year_summary, caption = "The number of species for each PFG")


pander(spp_co2_summary, caption = "The number of species for each CO2 treatment. Total number of species for each treatment (tot_), uniquely found ones (uni_) and commonly found in both CO2 treatments (common)", justify = "right")

pander(pfg_cov_summary, caption = "% coverage of each PFG")

pander(tail(spp_cov_summary, n = 10), caption = "% coverage of top 10 species")
```



# Univariate analysis (ANCOVA)

## Summary results

```{r summary_stats, echo=FALSE, warning=FALSE}
all_tbl <- all_tbl[order(all_tbl$report, decreasing = TRUE), ]
pcol <- grep("_P$", names(all_tbl))
d <- all_tbl
d[, pcol] <- apply(d[, pcol], 2, as.numeric)
d[is.na(d)] <- 0

emphasize.italics.cols(pcol)
emphasize.strong.cells(which(d <= .1, arr.ind = TRUE))

pander(all_tbl, caption = "Summary of repeated measures ANOVA", justify = "right", split.table = Inf, keep.line.breaks = TRUE)
```


## Diversity indices


```{r div_plot, echo=FALSE, fig.cap="Fig.1 Diversity indices. Black points depict mean values adjusted by Year0 values with 95% CI. Gray points depict observed values for each FACE ring.", fig.height=6, fig.width=6}
grid.draw(grass_mplot)
```


```{r div_tbl, echo=FALSE}
names(div_tbl_l) <- c("Diversity", "Evenness", "Species richness")
l <- llply(names(div_tbl_l), function(x) pander(div_tbl_l[[x]], caption = x, justify = "right"))
l[[1]]
l[[2]]
l[[3]]
```




## Dominent species


```{r dom_plot, echo=FALSE, fig.cap="Fig.2 Dominent species. Black points depict mean values adjusted by Year0 values with 95% CI. Gray points depict observed values for each FACE ring.", fig.height=5.5, fig.width=5}
fig_domspp
```


```{r dom_tbl, echo=FALSE}
l <- llply(names(domsp_tbl_l), function(x) pander(domsp_tbl_l[[x]], caption = x, justify = "right"))
l[[1]]
l[[2]]
l[[3]]
l[[4]]
```



## Proportions of plant functional groups


```{r pfgprop_plot, echo=FALSE, fig.cap="Fig.3 C4 proportion. Black points depict mean values adjusted by Year0 values with 95% CI. Gray points depict observed values for each FACE ring.",fig.height=5.5, fig.width=5}
fig_c4prop
```


```{r pfgprop_tbl, echo=FALSE}
names(pfgprop_tbl_l) <- c("C4:C3", "Grass:Forb", "Legume:Non-legume", "Natvie:Introduced")
l <- llply(names(pfgprop_tbl_l), function(x) pander(pfgprop_tbl_l[[x]], caption = x, justify = "right"))
l[[1]]
l[[2]]
l[[3]]
l[[4]]
```




# Multivariate analysis (PRC and MDS)

Log transformation (log(n + 1)) was applied to species data to improve asymmetric distribution of species abundance.

```{r fig_prc_mds, echo=FALSE, fig.width = 6.5, fig.height = 3, fig.cap="Results of PRC and MDS", warning=FALSE}
multiplot(plotlist = prc_figs[1:2], layout = lo)
```


```{r prc_res, echo=FALSE, results='markup'}
prc_res
```




```{r mds_env_tbl, echo=FALSE, results='asis'}
emphasize.italics.cols(5)
emphasize.strong.cells(cbind(which(mds_envfit_d$p <= .1), 5))
pander(mds_envfit_d, caption = "Summary of environmental variables fitted to the first two MDS axes")
```




# Annual changes in C4 and C3 abundance
Here, I examined the effects of eCO$_2$ on annual changes in C3 and C4 abundance ($\Delta$C4, C3) in relation to understorey temperature, PAR and soil moisture. I tested CO$_2$ and interactions between CO$_2$ and the others. I selected those models with $\Delta AIC <= 2$ as plausible candidates, and employed model averaging over them.  

```{r deltaC34_fig, echo=FALSE, fig.width=6.5, fig.height=5.5, fig.cap="Regression analysis for delta C3 and C4"}
grid.newpage()
grid.draw(deltaC34_fig)
```



## C4 graminoid
```{r c4_model_selection, echo=FALSE, results='markup', message=FALSE}
glbm <- get.models(c4d_m0_full, subset = "128")[[1]]  # global model
nulm <- get.models(c4d_m0_full, subset = "1")[[1]]    # null model

subset(c4d_m0_full, delta <= 2)
model.sel(glbm, nulm, rank = AICc, rank.args = alist(REML = F), extra = "r.squaredGLMM")
```


```{r c4_model_summary, echo=FALSE, results='asis'}
coefc4 <- cbind(coef(c4d_m0_bs_lm), confint(c4d_m0_bs_lm))
colnames(coefc4) <- c("estimate", "lwr", "upr")
coefc4 <- data.frame(coefc4) %>% 
  mutate(predictor = row.names(.)) %>% 
  mutate_each(funs(round(., 3)), estimate, lwr, upr) %>% 
  transmute(predictor, coefs = paste0(estimate, " [", lwr, ", ", upr, "]"))
pander(coefc4)
```




## C3 graminoid
```{r c3_model_selection, echo=FALSE, results='markup', message=FALSE}
glbm <- get.models(c3d_m0full, subset = "128")[[1]]  # global model
nulm <- get.models(c3d_m0full, subset = "1")[[1]]    # null model

subset(c3d_m0full, delta <= 2)
model.sel(glbm, nulm, rank = AICc, rank.args = alist(REML = F), extra = "r.squaredGLMM")
```


```{r c3_model_summary, echo=FALSE, results='asis'}
coeftbl <- data.frame(cbind(dc3_confint[-(1:4), ], 
                            estimate = coef(summary(c3d_m0bs))[, "Estimate"])) %>% 
  transmute(predictor = row.names(.),
            estimate  = round(estimate, 3),
            CI        = paste0("[", round(.[, 1], 3), ", ", round(.[, 2], 3), "]"))
pander(coeftbl)
```




# Appendix

## Species coverage
```{r sp_cov_tbl, echo=FALSE, results='asis'}
pander(spp_cov_summary)
```



## Species weight of PRC
```{r sp_weight_prc, echo=FALSE, results='asis'}
emphasize.italics.cols(1)
pander(res_pric_sp_tbl)

```

